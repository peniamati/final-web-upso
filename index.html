<!DOCTYPE html>
<html lang="es-AR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Birr4You</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="./css/styles.css" />
  <link rel="shortcut icon" href="../img/b4y_icon.ico" type="image/x-icon">
</head>

<body>
  <header class="header">
    <div class="header-logo">
      <a class="header-logo-a" href="./index.html"><img class="header-logo-img" src="./img/b4y.jpg"
          alt="Logo de Birra4You" /></a>
      <a class="header-logo-a" href="./index.html">
        <h1 class="header-logo-h1">BIRR4YOU</h1>
      </a>
      <a class="header-logo-a" href="../index.html"><img class="header-logo-img-right" src="./img/b4y.jpg"
          alt="Logo de Birra4You" /></a>
    </div>
    <div class="header-nav-container">
      <nav class="header-nav">
        <div class="header-nav-container">
          <div class="header-nav-search">
            <input id="buscador" type="text" placeholder="Busque su producto" />
            <button id="boton-buscar" onclick="searchPage()"><i class="fas fa-search"></i></button>
          </div>
          <div class="header-nav-cart-login">
            <button onclick="toggleCart()">
              <i id="cartIcon" class="fa-sharp fa-solid fa-cart-shopping"></i>
            </button>
            <div id="cart" style="display: none">
              <h2>Carrito de compras</h2>
              <ul id="cart-items"></ul>
            </div>
            <button onclick="toggleLogin()" id="loginBtn">
              <i class="far fa-user"></i>
            </button>
            <div id="modal" style="display: none;">

            </div>

          </div>
        </div>
        <ul class="header-nav-ul">
          <li class="header-nav-ul-li">
            <a class="header-nav-ul-li-a" href="./index.html">PRODUCTOS</a>
          </li>
          <select id="sel-category">

          </select>
          <li class="header-nav-ul-li">
            <a class="header-nav-ul-li-a" href="./pages/contacto.html">CONTACTO</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  <main>
    <section id="productos-section">
      <h2 class="productos-h2">Nuestros productos</h2>
      <article id="productos"></article>
    </section>
    <section class="recommended-products">
      <h2 class="recommended-products-h2">Cervezas recomendadas</h2>
      <table class="recommended-products-table">
        <tr class="recommended-products-table-tr">
          <td class="recommended-products-table-tr-td">
            <div class="recommended-products-table-tr-td-product">
              <h3 class="recommended-products-table-tr-td-product-h3">
                Cerveza Corona
              </h3>
              <p class="recommended-products-table-tr-td-product-p">
                Esta cerveza de origen andino se caracteriza por un sabor
                suave con dejos de roble
              </p>
              <button class="recommended-products-table-tr-td-product-button">
                Comprar
              </button>
            </div>
          </td>
          <td class="recommended-products-table-tr-td-img-container">
            <img class="recommended-products-table-tr-td-img" src="./img/corona.png" alt="Cerveza Corona" />
          </td>
        </tr>
        <tr class="recommended-products-table-tr">
          <td class="recommended-products-table-tr-td">
            <div class="recommended-products-table-tr-td-product">
              <h3 class="recommended-products-table-tr-td-product-h3">
                Six Pack Brahma
              </h3>
              <p class="recommended-products-table-tr-td-product-p">
                Brahma Dorada, es fácil de tomar, suave y ligera, con baja
                carbonatación.
              </p>
              <button class="recommended-products-table-tr-td-product-button">
                Comprar
              </button>
            </div>
          </td>
          <td class="recommended-products-table-tr-td-img-container">
            <img class="recommended-products-table-tr-td-img" src="./img/brahma.jpg" alt="Six Pack Brahma" />
          </td>
        </tr>
        <tr class="recommended-products-table-tr">
          <td class="recommended-products-table-tr-td">
            <div class="recommended-products-table-tr-td-product">
              <h3 class="recommended-products-table-tr-td-product-h3">
                Six Pack Brahma
              </h3>
              <p class="recommended-products-table-tr-td-product-p">
                Brahma Dorada, es fácil de tomar, suave y ligera, con baja
                carbonatación.
              </p>
              <button class="recommended-products-table-tr-td-product-button">
                Comprar
              </button>
            </div>
          </td>
          <td class="recommended-products-table-tr-td-img-container">
            <img class="recommended-products-table-tr-td-img" src="./img/brahma.jpg" alt="Six Pack Brahma" />
          </td>
        </tr>
      </table>
    </section>
  </main>
  <footer class="footer">
    <div class="footer-content">
      <a class="footer-content-a" href="">Contacto</a>
      <a class="footer-content-a" href="">Sobre Nosotros</a>
      <div class="footer-content-social-media">
        <a class="footer-content-social-media-a" href="https://facebook.com"><i class="fab fa-facebook"></i></a>
        <a class="footer-content-social-media-a" href="https://twitter.com"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
    <a href="./index.html"><img class="footer-content-img" src="./img/b4y.jpg" alt="Logo de Birra4You" /></a>
    <p class="footer-content-p">
      Integrantes: Peña Matias - Macchia Sebastian
    </p>
  </footer>

  <script>
    // Llamar a la función para obtener todas las cervezas al cargar la página
    window.onload = inicio;
    var shoppingCart = [];

    function getAllCervezas() {
      fetch("https://b4you.free.mockoapp.net/beers")
        .then((resp) => {
          return resp.json();
        })
        .then((cervezasArray) => {
          let productos = document.getElementById("productos");
          cervezasArray.forEach((cerveza) => {
            var div = document.createElement("div");
            div.id = "producto-div";

            var title = document.createElement("h3");
            title.innerHTML = cerveza.title;

            var img = document.createElement("img");
            img.src = cerveza.image;

            var description = document.createElement("p");
            description.innerHTML = cerveza.description;

            var price = document.createElement("p");
            price.id = 'price';
            price.innerHTML = "$" + cerveza.price;

            var button = document.createElement("button");
            button.classList.add("addButton");
            button.innerHTML = "Agregar";

            div.appendChild(title);
            div.appendChild(img);
            div.appendChild(description);
            div.appendChild(price);
            div.appendChild(button);

            productos.appendChild(div);
          });

          // Agregar evento de clic a los botones de agregar cerveza
          var addButtons = document.getElementsByClassName("addButton");
          for (var i = 0; i < addButtons.length; i++) {
            addButtons[i].addEventListener("click", addToCart);
          }
        });
    }

    function getAllCervezasByCategory(categoryId) {
      fetch("https://b4you.free.mockoapp.net/beers")
        .then((resp) => resp.json())
        .then((cervezasArray) => {
          let productos = document.getElementById("productos");
          productos.innerHTML = "";

          const filteredCervezas = cervezasArray.filter(
            (cerveza) => cerveza.category_id == categoryId
          );

          filteredCervezas.forEach((cerveza) => {
            var div = document.createElement("div");
            div.id = "producto-div";

            var title = document.createElement("h3");
            title.innerHTML = cerveza.title;

            var img = document.createElement("img");
            img.src = cerveza.image;

            var description = document.createElement("p");
            description.innerHTML = cerveza.description;

            var price = document.createElement("p");
            price.id = 'price';
            price.innerHTML = "$" + cerveza.price;

            var button = document.createElement("button");
            button.classList.add("addButton");
            button.innerHTML = "Agregar";

            div.appendChild(title);
            div.appendChild(img);
            div.appendChild(description);
            div.appendChild(price);
            div.appendChild(button);

            productos.appendChild(div);
          });

          // Agregar evento de clic a los botones de agregar cerveza
          var addButtons = document.getElementsByClassName("addButton");
          for (var i = 0; i < addButtons.length; i++) {
            addButtons[i].addEventListener("click", addToCart);
          }
        });
    }


    function addToCart(event) {
      // Obtener el contenedor del producto padre del botón clicado
      var productoDiv = event.target.closest("#producto-div");

      // Obtener los elementos dentro del contenedor
      var title = productoDiv.querySelector("h3").innerHTML;
      var imgSrc = productoDiv.querySelector("img").getAttribute("src");
      var price = parseFloat(productoDiv.querySelector("#price").innerHTML.replace("$", ""));

      // Verificar si el artículo ya está en el carrito
      var existingItem = shoppingCart.find((item) => item.title === title);
      if (existingItem) {
        // Si el artículo ya está en el carrito, incrementar la cantidad
        existingItem.quantity++;
      } else {
        // Si el artículo no está en el carrito, agregarlo con una cantidad de 1
        shoppingCart.push({
          title: title,
          imgSrc: imgSrc,
          price: price,
          quantity: 1
        });
      }

      // Mostrar los datos en el carrito
      displayCart();
    }

    function displayCart() {
      var cartItems = document.getElementById("cart-items");
      cartItems.innerHTML = "";

      // Recorrer los elementos del carrito y mostrarlos en el DOM
      shoppingCart.forEach((item, index) => {
        var li = document.createElement("li");
        li.id = "cartLi";

        var img = document.createElement("img");
        img.src = item.imgSrc;

        var title = document.createElement("p");
        title.id = "title";
        title.innerHTML = item.title;

        var divCant = document.createElement("div");
        divCant.id = "divCant";

        var quantity = document.createElement("p");
        quantity.innerHTML = "Cantidad: ";

        var decreaseButton = document.createElement("button");
        decreaseButton.innerHTML = "-";
        decreaseButton.addEventListener("click", function () {
          decreaseQuantity(index);
        });

        var quantityValue = document.createElement("p");
        quantityValue.innerHTML = item.quantity;

        var increaseButton = document.createElement("button");
        increaseButton.innerHTML = "+";
        increaseButton.addEventListener("click", function () {
          increaseQuantity(index);
        });

        var price = document.createElement("p");
        price.innerHTML = "Precio: $" + item.price.toFixed(2);

        var deleteButton = document.createElement("button");
        deleteButton.innerHTML = 'Eliminar ' + '<i class="fas fa-trash-alt"></i>';
        deleteButton.addEventListener("click", function () {
          removeItem(index);
        });

        quantity.appendChild(decreaseButton);
        quantity.appendChild(quantityValue);
        quantity.appendChild(increaseButton);


        divCant.appendChild(quantity);


        li.appendChild(title);
        li.appendChild(img);
        li.appendChild(divCant);
        li.appendChild(price);
        li.appendChild(deleteButton);

        cartItems.appendChild(li);
      });

      // Mostrar el carrito
      var cart = document.getElementById("cart");
      cart.style.display = "block";
    }

    function decreaseQuantity(index) {
      if (shoppingCart[index].quantity > 1) {
        shoppingCart[index].quantity--;
      }
      else if (shoppingCart[index].quantity = 1) {
        removeItem(index);
      }
      displayCart();
    }

    function increaseQuantity(index) {
      shoppingCart[index].quantity++;
      displayCart();
    }

    function removeItem(index) {
      shoppingCart.splice(index, 1);
      displayCart();
    }


    function toggleCart() {
      var cart = document.getElementById("cart");
      if (cart.style.display === "block") {
        cart.style.display = "none";
      } else {
        cart.style.display = "block";
      }
    }

    function inicio() {
      const selector = document.getElementById("sel-category");

      // Obtener el valor de la categoría seleccionada de la URL
      const searchParams = new URLSearchParams(window.location.search);
      const selectedCategory = searchParams.get("category");

      selector.addEventListener("change", function () {
        const selectedOption = selector.value;
        if (selectedOption !== "") {
          const searchParams = new URLSearchParams();
          searchParams.set("category", selectedOption);
          const newURL = "./index.html?" + searchParams.toString();
          window.location.href = newURL;
        }
      });

      fetch("https://b4you.free.mockoapp.net/categories")
        .then((resp) => {
          return resp.json();
        })
        .then((categoryList) => {
          let selector = document.getElementById("sel-category");
          let selectorCategorias = document.createElement("option");
          selectorCategorias.innerHTML = "CATEGORIAS";
          selector.appendChild(selectorCategorias);

          categoryList.forEach((category) => {
            let opt = document.createElement("option");
            opt.innerHTML = category.title;
            opt.value = category.id;
            selector.appendChild(opt);
          });

          selector.addEventListener("mousedown", function () {
            selector.firstElementChild.style.display = "none";
          });

          // Establecer el valor de la categoría seleccionada en el selector
          if (selectedCategory) {
            selector.value = selectedCategory;
          }

          // Llamar a la función getAllCervezasByCategory() con el valor de la categoría seleccionada
          if (selectedCategory) {
            getAllCervezasByCategory(selectedCategory);
          }



        })
        .then(getAllCervezas());
    };


    var busquedaInput = document.getElementById("buscador");
    var botonBuscar = document.getElementById("boton-buscar");
    var productosContainer = document.getElementById("productos");

    function searchPage() {
      var searchText = busquedaInput.value.toLowerCase();

      fetch("https://b4you.free.mockoapp.net/beers")
        .then((resp) => resp.json())
        .then((cervezasArray) => {
          productosContainer.innerHTML = "";

          const filteredCervezas = cervezasArray.filter((cerveza) =>
            cerveza.title.toLowerCase().includes(searchText)
          );

          if (filteredCervezas.length === 0) {
            // Mostrar mensaje de no encontrado
            alert("No se encontraron productos con ese texto");
          } else {
            filteredCervezas.forEach((cerveza) => {
              var div = document.createElement("div");
              div.id = "producto-div";

              var title = document.createElement("h3");
              title.innerHTML = cerveza.title;

              var img = document.createElement("img");
              img.src = cerveza.image;

              var description = document.createElement("p");
              description.innerHTML = cerveza.description;

              var price = document.createElement("p");
              price.id = "price";
              price.innerHTML = "$" + cerveza.price;

              var button = document.createElement("button");
              button.classList.add("addButton");
              button.innerHTML = "Agregar";

              div.appendChild(title);
              div.appendChild(img);
              div.appendChild(description);
              div.appendChild(price);
              div.appendChild(button);

              productosContainer.appendChild(div);
            });

            // Ocultar los productos no coincidentes
            var allProductos = document.querySelectorAll("#producto-div");
            allProductos.forEach((producto) => {
              if (!filteredCervezas.some((cerveza) => producto.querySelector("h3").innerHTML === cerveza.title)) {
                producto.style.display = "none";
              }
            });

            // Agregar evento de clic a los botones de agregar cerveza
            var addButtons = document.getElementsByClassName("addButton");
            for (var i = 0; i < addButtons.length; i++) {
              addButtons[i].addEventListener("click", addToCart);
            }
          }
        });


      // Limpiar el campo de búsqueda
      busquedaInput.value = "";
    }

    // Asignar la función de búsqueda al evento click del botón
    botonBuscar.addEventListener("click", function () {
      if (busquedaInput.value.trim() !== "") {
        searchPage();
      }
    });

    function loginForm() {
      let divLogin = document.getElementById("modal");
      divLogin.innerHTML = "";

      let divContent = document.createElement("div");
      divContent.className = "modal-content";

      let closeSpan = document.createElement("button");
      closeSpan.innerHTML = '<i class="fas fa-window-close"></i>';
      closeSpan.id = "cerrarLogin";
      closeSpan.onclick = closeLogin;

      let formH2 = document.createElement("h2");
      formH2.innerHTML = "Iniciar Sesion"

      let form = document.createElement("form");
      form.id = "login-form";

      let username = document.createElement("label");
      username.for = "username";
      username.innerHTML = "Usuario:"

      let usernameInput = document.createElement("input");
      usernameInput.type = "text";
      usernameInput.id = "username";
      usernameInput.name = "username";
      usernameInput.required = true;

      let password = document.createElement("label");
      password.for = "password";
      password.innerHTML = "Contraseña:"

      let passwordInput = document.createElement("input");
      passwordInput.type = "text";
      passwordInput.id = "password";
      passwordInput.name = "password";
      passwordInput.required = true;


      let submit = document.createElement("button");
      submit.type = "submit";
      submit.innerHTML = "Ingresar";
      submit.onclick = ingresar;


      form.appendChild(username);
      form.appendChild(usernameInput);
      form.appendChild(password);
      form.appendChild(passwordInput);
      form.appendChild(submit);

      divContent.appendChild(closeSpan);
      divContent.appendChild(formH2);
      divContent.appendChild(form);

      divLogin.appendChild(divContent);
    }

    function toggleLogin() {
      let modal = document.getElementById("modal");
      loginForm();
      modal.style.display = "block";
    }

    function closeLogin() {
      let modal = document.getElementById("modal");
      modal.style.display = "none";
    }

    function ingresar(){
      let username = document.getElementById("username");
      let password = document.getElementById("password");

      if (username.value === "admin") {
        if (password.value === "admin"){
          form.close();
        }
        else{
          alert("Contraseña incorrecta")
        }
      }
      else{
        alert("Usuario incorrecto")
      } 
      

    }

  </script>
</body>

</html>